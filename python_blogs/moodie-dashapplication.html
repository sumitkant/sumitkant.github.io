<!DOCTYPE html>
<!--[if IE 8 ]><html class="no-js oldie ie8" lang="en"> <![endif]-->
<!--[if IE 9 ]>
<html class="no-js oldie ie9" lang="en">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]>
<!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>

    <!--- basic page needs
   ================================================== -->
    <meta charset="utf-8">
    <title>Blog | Modie - Dash Application</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- mobile specific metas
   ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- CSS
   ================================================== -->

    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/vendor.css">
    <link rel="stylesheet" href="../css/main.css">


    <!-- script
   ================================================== -->
    <script src="../js/modernizr.js"></script>
    <script src="../js/pace.min.js"></script>

    <!-- favicons
	================================================== -->
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

</head>

<body id="top">

    <!-- header 
   ================================================== -->
    <header class="short-header">

        <div class="gradient-block"></div>

        <div class="row header-content">

            <div class="logo">
                <a href="../index.html">Sumit Kant</a>
            </div>

            <nav id="main-nav-wrap">
                <ul class="main-navigation sf-menu">
                    <li><a href="../index.html" title="">Home</a></li>
                    <!--
                    <li class="has-children">
                        <a href="category.html" title="">Categories</a>
                        <ul class="sub-menu">
                            <li><a href="category.html">Wordpress</a></li>
                            <li><a href="category.html">HTML</a></li>
                            <li><a href="category.html">Photography</a></li>
                            <li><a href="category.html">UI</a></li>
                            <li><a href="category.html">Mockups</a></li>
                            <li><a href="category.html">Branding</a></li>
                        </ul>
                    </li>
-->
                    <li class="has-children current">
                        <a href="../blog.html" title="">Blog</a>
                        <!--
                        <ul class="sub-menu">
                            <li><a href="single-video.html">Video Post</a></li>
                            <li><a href="single-audio.html">Audio Post</a></li>
                            <li><a href="single-gallery.html">Gallery Post</a></li>
                            <li><a href="single-standard.html">Standard Post</a></li>
                        </ul>
-->
                    </li>
                    <li><a href="../books.html" title="">Books</a></li>
                    <!--                    <li><a href="style-guide.html" title="">Styles</a></li>-->
                    <li><a href="../about.html" title="">About</a></li>
                    <!-- <li><a href="contact.html" title="">Contact</a></li> -->
                </ul>
            </nav> <!-- end main-nav-wrap -->

            <div class="search-wrap">

                <form role="search" method="get" class="search-form" action="#">
                    <label>
                        <span class="hide-content">Search for:</span>
                        <input type="search" class="search-field" placeholder="Type Your Keywords" value="" name="s" title="Search for:" autocomplete="off">
                    </label>
                    <input type="submit" class="search-submit" value="Search">
                </form>

                <a href="#" id="close-search" class="close-btn">Close</a>

            </div> <!-- end search wrap -->

            <div class="triggers">
                <a class="search-trigger" href="#"><i class="fa fa-search"></i></a>
                <a class="menu-toggle" href="#"><span>Menu</span></a>
            </div> <!-- end triggers -->

        </div>

    </header> <!-- end header -->


    <!-- content
   ================================================== -->
    <section id="content-wrap" class="blog-single">
        <div class="row">
            <div class="col-twelve">

                <article class="format-standard">

                    <div class="content-media">
                        <div class="post-thumb">
                            <img src="../images/Blogs/8.MoodieDashApp/MOODIE_APP.jpg">
                        </div>
                    </div>

                    <div class="primary-content">

                        <h1 class="page-title">Moodie | A Dash Application</h1>

                        <ul class="entry-meta">
                            <li class="date">June 24, 2020</li>
                            <li class="cat"><a href="">CNN</a><a href="">Python, TensorFlow</a></li>
                        </ul>

                        
                        <p>A fun weekend project of deploying my first CNN based model in production using heroku. This is how it looks like  <a href="http://knowyourmood.herokuapp.com/" target="_blank"><b>Link to Moodie App</b></a></p>
                        
                        

                        <p>Moodie was a weekend project to deploy a TensorFlow based model in production.  </p>
                        <p>The model was tasked to predict the facial expression given an input image. The output is one of seven facial expressions from /Happy, Sad, Disgust, Afraid, Surprise, Neutral/. The app is designed to take one or multiple images and throw out predictions for each image separately, along with a graph on what other expressions were probable. I deployed this model on heroku by creating a Dash Application. </p>
                        <p>Let’s dive deep!</p>
                        
                        <h2>The Ingredients</h2>
                        
                        <p>To create and deploy this kind of we needed 4 things</p>
                        
                        <h3>Dash by Plotly (Frontend & Backend)</h3>
                        <p> <a href="https://plotly.com/dash/"><b>Dash</b></a> is an open Source library released by Plotly to build web apps with ease. It takes care of both front end and back-end and lets you focus on the core of your UI, your app.</p>
                        
                        
                        <h3>Heroku (Server)</h3>
                        <p> <a href="https://www.heroku.com/about"><b>Heroku</b></a> is a cloud platform as a service that lets you build and deploy web apps. It has both free and paid subscriptions to test our your apps and deploy full scale. </p>
                        
                        <h3>TensorFlow </h3>
                        <p> <a href="https://www.tensorflow.org"><b>TensorFlow</b></a> is an end to end open source machine learning platform. It has an ecosystem of all the tools you’ll need to build and deploy a machine learning model at scale.</p>
                        
                        <h3>Git </h3>
                        <p> <a href="https://www.tensorflow.org"><b>Git</b></a> is a version control system used for tracking changes in the code. This is required to run commands to deploy the app in heroku.</p>
                        
                        
                        <h2>Making the Moodie Stew</h2>
                        <p>To create this app, the following steps were followed</p>
                        <ol>
                            <li>Train a CNN on facial expression data and generate a compatible model file</li>
                            <li>Write a python script that takes image as user input, converts into tensorflow readable format and scores the image to get predictions on the facial expression</li>
                            <li>Package the steps in app.py file and deploying it on Heroku</li>
                        </ol>
                        
                        <p>I have used Anaconda to manage all open source package installations</p>
                        
                        <h3>Virtual Environment</h3>
                        <p>A virtual environment is a python environment with python and other scripts installed that are isolated from already installed packages in the default location. The max size of the app cannot be more than 500 MB for it to be deployed on Heroku. This will come handy when specifying requirements of installed packages and versions for the app</p>
                        
                        <p>The virtual environment can be created with the following command. TensorFlow is stable for python 3.7, so we specified that in the <code>create</code> command. Once created we can activate the environment using <code>conda activate</code>. To learn more about virtual environments, check out the <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html"><b>official documentation</b></a></p>
                    
<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%">conda create —-name moodie <span style="color: #B8860B">python</span><span style="color: #666666">=</span>3.7
Conda activate moodie
</pre>    

                        <br>


                        <h3>Installing Packages</h3>
                        <p>Using the anaconda prompt we can install the following packages one by one. Note that we are only installing tensorflow-cpu just to ensure that our app size remains within 500MB. Since our model takes input one at a time and there is no complex processing of image, we can use tensorflow-cpu.</p>
                        
                        <p>We will also need Python Imaging Library to manipulate images and pass it to the pre-trained model.</p>
                        

<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%">pip install dash
pip install tensorflow-cpu
pip install Pillow
</pre>

                        <br>
                        
                        <h3>App.py</h3>
                        <p>This is the heart of the app. App.py file will determine how your app looks and what functions it performs. To create this app, I just need 2 things</p>
                        <ol>
                            <li>Upload button - A mechanism to upload or take a picture </li>
                            <li>Output Area - where the image will be displayed &amp; predictions will be made. The output area also contains a bar graph of all probable emotions and their modelled probabilities.</li>
                        </ol>
                        
                        <p>Let's first initialize the app. We will need the following libraries to be imported</p>
                        
<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic"># basic</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF;">base64</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF;">io</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF;">numpy</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>

<span style="color: #008800; font-style: italic"># dash</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF;">dash</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF;">dash_core_components</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF;">dcc</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF;">dash_html_components</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF;">html</span>
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF;">dash.dependencies</span> <span style="color: #AA22FF; font-weight: bold">import</span> Input, Output, State
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF;">plotly.graph_objs</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF;">go</span>

<span style="color: #008800; font-style: italic"># tensorflow &amp; keras</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF;">tensorflow</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF;">tf</span>
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF;">tensorflow.keras.models</span> <span style="color: #AA22FF; font-weight: bold">import</span> load_model
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF;">tensorflow.keras.preprocessing</span> <span style="color: #AA22FF;">import</span> image
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF;">PIL</span> <span style="color: #AA22FF; font-weight: bold">import</span> Image


app <span style="color: #666666">=</span> dash<span style="color: #666666">.</span>Dash(__name__)
server <span style="color: #666666">=</span> app<span style="color: #666666">.</span>server
app<span style="color: #666666">.</span>title <span style="color: #666666">=</span> <span style="color: #BB4444">&#39;Moodie | Sumit Kant&#39;</span>

app<span style="color: #666666">.</span>layout <span style="color: #666666">=</span> html<span style="color: #666666">.</span>Div([
    html<span style="color: #666666">.</span>H1(<span style="color: #BB4444">&#39;Moodie&#39;</span>)
])

<span style="color: #AA22FF; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BB4444">&#39;__main__&#39;</span>:
    app<span style="color: #666666">.</span>run_server(debug<span style="color: #666666">=</span><span style="color: #AA22FF">False</span>)
</pre>
                        <br>

                        
                        
                        <p>Dash provides a ready made script for uploading images using <code>dcc.Upload</code>. For a mobile device, the upload button also adds ‘click a picture’ feature using the on-device camera.</p>
                        
                        <p>Notice that when you try to upload an image, it serialises the string into a string which is then parsed to display the image. This can become a bottleneck when the image size is large. They may take longer time to upload and serialise and may not show any output because of the timeout. The way to increase the timeout is tricky, so i haven't explored it yet.</p>
                        
                        
<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%">dcc<span style="color: #666666">.</span>Upload(
        <span style="color: #AA22FF">id</span><span style="color: #666666">=</span><span style="color: #BB4444">&#39;upload-image&#39;</span>,
        children<span style="color: #666666">=</span>html<span style="color: #666666">.</span>Div([
            <span style="color: #BB4444">&#39;Drag and Drop or &#39;</span>,
            html<span style="color: #666666">.</span>A(<span style="color: #BB4444">&#39;Select Files&#39;</span>), <span style="color: #BB4444">&#39; to check your mood!&#39;</span>
        ]),
        multiple<span style="color: #666666">=</span><span style="color: #AA22FF">True</span>,
        max_size <span style="color: #666666">=</span> <span style="color: #666666">-1</span>
    )
</pre>

                        <br>
                        
                        <p>Next, we parse the serialised image into recognisable format (jpg) and manipulate this using the `pillow` package. What we need from the image is to be gray scale (or 1 channel) and all the pixel values to be normalised which is just dividing the image object by 255.</p>
                        
                        <p>Next we call predict method on the image which through out list of probabilities which are mapped to 	“crafted replies”. These replies will be displayed at the bottom of the image</p>
                        
                        <p>Next we just call a go object that takes expressions as string and probabilities as values and prepares the chart. Putting it all together will give us this final code</p>
                        
<!-- HTML generated using hilite.me --><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic"># basic</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">base64</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">io</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>

<span style="color: #008800; font-style: italic"># dash</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">dash</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">dash_core_components</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">dcc</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">dash_html_components</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">html</span>
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">dash.dependencies</span> <span style="color: #AA22FF; font-weight: bold">import</span> Input, Output, State
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">plotly.graph_objs</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">go</span>

<span style="color: #008800; font-style: italic"># tensorflow &amp; keras</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">tensorflow</span> <span style="color: #AA22FF; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">tf</span>
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">tensorflow.keras.models</span> <span style="color: #AA22FF; font-weight: bold">import</span> load_model
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">tensorflow.keras.preprocessing</span> <span style="color: #AA22FF; font-weight: bold">import</span> image
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">PIL</span> <span style="color: #AA22FF; font-weight: bold">import</span> Image


app <span style="color: #666666">=</span> dash<span style="color: #666666">.</span>Dash(__name__)
    
server <span style="color: #666666">=</span> app<span style="color: #666666">.</span>server

model <span style="color: #666666">=</span> load_model(<span style="color: #BB4444">&#39;trained_model/model_filter.h5&#39;</span>)

app<span style="color: #666666">.</span>title <span style="color: #666666">=</span> <span style="color: #BB4444">&#39;Moodie | Sumit Kant&#39;</span>

app<span style="color: #666666">.</span>layout <span style="color: #666666">=</span> html<span style="color: #666666">.</span>Div([

    html<span style="color: #666666">.</span>H1(<span style="color: #BB4444">&#39;Moodie&#39;</span>),
    html<span style="color: #666666">.</span>Div(<span style="color: #AA22FF">id</span> <span style="color: #666666">=</span> <span style="color: #BB4444">&#39;subtext&#39;</span>, children <span style="color: #666666">=</span>  [

        html<span style="color: #666666">.</span>P(<span style="color: #BB4444">&#39;Moodie is a fun weekend deep learning project that is designed to detect facial expressions from an image. The predictions are powered by a trained CNN model in keras using TensorFlow as backend. So go crazy and use any image of your liking...&#39;</span>),

        html<span style="color: #666666">.</span>P(<span style="color: #BB4444">&#39;P.S: None of your images are saved anywhere... :)&#39;</span>),

        html<span style="color: #666666">.</span>P(<span style="color: #BB4444">&#39;P.P.S: The CNN is not trained to detect whether the face exists or not, the assumption here is that an image of a face is uploaded and one of the 7 expression will dominate the prediction&#39;</span>)
        ]


        ),
    
        dcc<span style="color: #666666">.</span>Upload(
            <span style="color: #AA22FF">id</span><span style="color: #666666">=</span><span style="color: #BB4444">&#39;upload-image&#39;</span>,
            children<span style="color: #666666">=</span>html<span style="color: #666666">.</span>Div([
                <span style="color: #BB4444">&#39;Drag and Drop or &#39;</span>,
                html<span style="color: #666666">.</span>A(<span style="color: #BB4444">&#39;Select Files&#39;</span>), <span style="color: #BB4444">&#39; to check your mood!&#39;</span>
            ]),
            style<span style="color: #666666">=</span>{
                <span style="color: #BB4444">&#39;width&#39;</span>: <span style="color: #BB4444">&#39;100%&#39;</span>,
                <span style="color: #BB4444">&#39;lineHeight&#39;</span>: <span style="color: #BB4444">&#39;60px&#39;</span>,
                <span style="color: #BB4444">&#39;borderWidth&#39;</span>: <span style="color: #BB4444">&#39;1px&#39;</span>,
                <span style="color: #BB4444">&#39;borderStyle&#39;</span>: <span style="color: #BB4444">&#39;dashed&#39;</span>,
                <span style="color: #BB4444">&#39;borderRadius&#39;</span>: <span style="color: #BB4444">&#39;10px&#39;</span>, 
                <span style="color: #BB4444">&#39;textAlign&#39;</span>: <span style="color: #BB4444">&#39;center&#39;</span>,
            },
            <span style="color: #008800; font-style: italic"># Allow multiple files to be uploaded</span>
            multiple<span style="color: #666666">=</span><span style="color: #AA22FF">True</span>,
            max_size <span style="color: #666666">=</span> <span style="color: #666666">-1</span>

        ), <span style="color: #008800; font-style: italic"># dcc.Upload</span>
    
    dcc<span style="color: #666666">.</span>Loading(
        <span style="color: #AA22FF">id</span><span style="color: #666666">=</span><span style="color: #BB4444">&quot;upload-image-loading&quot;</span>,
        children <span style="color: #666666">=</span> [html<span style="color: #666666">.</span>Div(<span style="color: #AA22FF">id</span><span style="color: #666666">=</span><span style="color: #BB4444">&#39;output-image-upload&#39;</span>)],
        <span style="color: #AA22FF">type</span><span style="color: #666666">=</span><span style="color: #BB4444">&#39;dot&#39;</span>,
        color <span style="color: #666666">=</span> <span style="color: #BB4444">&#39;black&#39;</span>
        ),

    html<span style="color: #666666">.</span>Div(<span style="color: #BB4444">&#39;© Copyright 2020 | Sumit Kant&#39;</span>, <span style="color: #AA22FF">id</span><span style="color: #666666">=</span><span style="color: #BB4444">&#39;copyright&#39;</span>)
])



<span style="color: #AA22FF; font-weight: bold">def</span> <span style="color: #00A000">parse_contents</span>(contents, filename):

    content_type, content_string <span style="color: #666666">=</span> contents<span style="color: #666666">.</span>split(<span style="color: #BB4444">&#39;,&#39;</span>)
    decoded <span style="color: #666666">=</span> base64<span style="color: #666666">.</span>b64decode(content_string)
    fh <span style="color: #666666">=</span> <span style="color: #AA22FF">open</span>(<span style="color: #BB4444">&quot;imageToSave.jpg&quot;</span>, <span style="color: #BB4444">&quot;wb&quot;</span>)
    fh<span style="color: #666666">.</span>write(decoded)
    fh<span style="color: #666666">.</span>close()


    img <span style="color: #666666">=</span> image<span style="color: #666666">.</span>load_img(<span style="color: #BB4444">&#39;imageToSave.jpg&#39;</span>, color_mode<span style="color: #666666">=</span><span style="color: #BB4444">&#39;grayscale&#39;</span>, target_size<span style="color: #666666">=</span>(<span style="color: #666666">48</span>, <span style="color: #666666">48</span>))
    x   <span style="color: #666666">=</span> image<span style="color: #666666">.</span>img_to_array(img)
    x   <span style="color: #666666">=</span> np<span style="color: #666666">.</span>expand_dims(x, axis <span style="color: #666666">=</span> <span style="color: #666666">0</span>)
    x  <span style="color: #666666">/=</span> <span style="color: #666666">255</span>

    pred <span style="color: #666666">=</span> model<span style="color: #666666">.</span>predict(x)

    values <span style="color: #666666">=</span> [<span style="color: #AA22FF">int</span>(<span style="color: #AA22FF">round</span>(x<span style="color: #666666">*100</span>,<span style="color: #666666">0</span>)) <span style="color: #AA22FF; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> pred[<span style="color: #666666">0</span>]]
    labels <span style="color: #666666">=</span> [<span style="color: #BB4444">&#39;Anger&#39;</span>,<span style="color: #BB4444">&#39;Disgust&#39;</span>,<span style="color: #BB4444">&#39;Fear&#39;</span>,<span style="color: #BB4444">&#39;Happy&#39;</span>,<span style="color: #BB4444">&#39;Sad&#39;</span>,<span style="color: #BB4444">&#39;Surprise&#39;</span>,<span style="color: #BB4444">&#39;Neutral&#39;</span>]


    objects <span style="color: #666666">=</span> [
        <span style="color: #BB4444">&#39;Angry? or Hangry?&#39;</span>, 
        <span style="color: #BB4444">&#39;Disgusted? Huh?&#39;</span>, 
        <span style="color: #BB4444">&#39;Afraid? Don</span><span style="color: #BB6622; font-weight: bold">\&#39;</span><span style="color: #BB4444">t be...&#39;</span>, 
        <span style="color: #BB4444">&#39;Yay! You</span><span style="color: #BB6622; font-weight: bold">\&#39;</span><span style="color: #BB4444">re happy!!&#39;</span>, 
        <span style="color: #BB4444">&#39;Why so sad?&#39;</span>, 
        <span style="color: #BB4444">&#39;Surprised!!!&#39;</span>, 
        <span style="color: #BB4444">&#39;Neutral? #NoNeutrals&#39;</span>
    ]

    <span style="color: #AA22FF; font-weight: bold">return</span> html<span style="color: #666666">.</span>Div([
            <span style="color: #008800; font-style: italic"># html.H5(filename),</span>
            <span style="color: #008800; font-style: italic"># HTML images accept base64 encoded strings in the same format</span>
            <span style="color: #008800; font-style: italic"># that is supplied by the upload</span>
            html<span style="color: #666666">.</span>Img(src<span style="color: #666666">=</span>contents),
            html<span style="color: #666666">.</span>H4(objects[pred<span style="color: #666666">.</span>argmax()]),
            html<span style="color: #666666">.</span>Div([
                 dcc<span style="color: #666666">.</span>Graph(
                    <span style="color: #AA22FF">id</span> <span style="color: #666666">=</span> <span style="color: #BB4444">&#39;bar_chart&#39;</span>,
                    
                    figure <span style="color: #666666">=</span> {
                    
                        <span style="color: #BB4444">&#39;data&#39;</span>: [go<span style="color: #666666">.</span>Bar(
                            y <span style="color: #666666">=</span> labels, 
                            x <span style="color: #666666">=</span> values,
                            textposition <span style="color: #666666">=</span><span style="color: #BB4444">&#39;auto&#39;</span>,
                            text <span style="color: #666666">=</span> [<span style="color: #AA22FF">str</span>(v)<span style="color: #666666">+</span><span style="color: #BB4444">&#39;%&#39;</span> <span style="color: #AA22FF; font-weight: bold">for</span> v <span style="color: #AA22FF; font-weight: bold">in</span> values],
                            marker_color <span style="color: #666666">=</span> [<span style="color: #BB4444">&#39;black&#39;</span>]<span style="color: #666666">*</span><span style="color: #AA22FF">len</span>(labels),
                            hoverinfo <span style="color: #666666">=</span><span style="color: #BB4444">&#39;skip&#39;</span>,
                            orientation <span style="color: #666666">=</span> <span style="color: #BB4444">&#39;h&#39;</span>,

                            )],

                        <span style="color: #BB4444">&#39;layout&#39;</span>: go<span style="color: #666666">.</span>Layout(
                            xaxis <span style="color: #666666">=</span> {<span style="color: #BB4444">&#39;showgrid&#39;</span>: <span style="color: #AA22FF">False</span>, <span style="color: #BB4444">&#39;ticks&#39;</span> : <span style="color: #BB4444">&#39;&#39;</span>, <span style="color: #BB4444">&#39;showticklabels&#39;</span> :<span style="color: #AA22FF">False</span>, <span style="color: #BB4444">&#39;zeroline&#39;</span>: <span style="color: #AA22FF">False</span>},
                            yaxis <span style="color: #666666">=</span> {<span style="color: #BB4444">&#39;showgrid&#39;</span>: <span style="color: #AA22FF">False</span>, <span style="color: #BB4444">&#39;ticks&#39;</span> : <span style="color: #BB4444">&#39;&#39;</span>, <span style="color: #BB4444">&#39;zeroline&#39;</span>: <span style="color: #AA22FF">False</span>},
                            font  <span style="color: #666666">=</span> {<span style="color: #BB4444">&#39;family&#39;</span> : <span style="color: #BB4444">&#39;Lora&#39;</span>, <span style="color: #BB4444">&#39;size&#39;</span> : <span style="color: #666666">14</span>},
                            margin <span style="color: #666666">=</span> {<span style="color: #BB4444">&#39;pad&#39;</span> : <span style="color: #666666">10</span>, <span style="color: #BB4444">&#39;l&#39;</span>:<span style="color: #666666">100</span>, <span style="color: #BB4444">&#39;r&#39;</span>:<span style="color: #666666">25</span>, <span style="color: #BB4444">&#39;t&#39;</span>:<span style="color: #666666">50</span>, <span style="color: #BB4444">&#39;b&#39;</span>:<span style="color: #666666">50</span>},
                            title <span style="color: #666666">=</span> <span style="color: #BB4444">&#39;Detected Expressions&#39;</span>,
                            height<span style="color: #666666">=300</span>,
                            )
                        },

                    config <span style="color: #666666">=</span> {
                        <span style="color: #BB4444">&#39;displayModeBar&#39;</span>: <span style="color: #AA22FF">False</span>
                        }
                )]),
        ])


<span style="color: #AA22FF">@app.callback</span>(Output(<span style="color: #BB4444">&#39;output-image-upload&#39;</span>, <span style="color: #BB4444">&#39;children&#39;</span>),
              [Input(<span style="color: #BB4444">&#39;upload-image&#39;</span>, <span style="color: #BB4444">&#39;contents&#39;</span>)],
              [State(<span style="color: #BB4444">&#39;upload-image&#39;</span>, <span style="color: #BB4444">&#39;filename&#39;</span>)])
<span style="color: #AA22FF; font-weight: bold">def</span> <span style="color: #00A000">update_output</span>(list_of_contents, list_of_names):
    <span style="color: #AA22FF; font-weight: bold">if</span> list_of_contents <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF">None</span>:
        children <span style="color: #666666">=</span> [
            parse_contents(c, n) <span style="color: #AA22FF; font-weight: bold">for</span> c, n <span style="color: #AA22FF; font-weight: bold">in</span>
            <span style="color: #AA22FF">zip</span>(list_of_contents, list_of_names)]
        <span style="color: #AA22FF; font-weight: bold">return</span> children


<span style="color: #AA22FF; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BB4444">&#39;__main__&#39;</span>:
    app<span style="color: #666666">.</span>run_server(debug<span style="color: #666666">=</span><span style="color: #AA22FF">False</span>)
</pre>

                        <br>



                        <h3>Deployment errands</h3>
                        
                        <p>Once we are at the stage when we are satisfied with our code. We will now use git to run heroku commands. </p>
                    
                        <p>For deploying a dash application on Heroku, the <a href="https://dash.plot.ly/deployment" target = "_blank"><b>documentation</b></a> given by plotly is clear enough. If you are deploying your Dash app on Heroku, just replace the code in the documentation with your <code>app.py</code> code and follow along as described.</p>
                        
                        
                        <h2>Results</h2>
                        
                        <p>This app yeilded some interesting results. For example, even Venom was looking happy in this image.</p>
                        <p>See for yourself - <a href="http://knowyourmood.herokuapp.com/" target="_blank"><b>Link to Web App</b></a></p>
                        
                        <img src="../images/Blogs/8.MoodieDashApp/results_1.png" alt="Detecting facial expressions of Venom">
                        
                    
                    </div> <!-- primary-content -->
                       
                        <!-- END OF BLOG -->

                    <div class="pagenav group">
                        <div class="prev-nav">
                            <a href="intro-to-deep-learning-mit-notes.html" rel="prev">
                                <span>Previous</span>
                                [Notes] Intro to Deep Learning - MIT 6.S191
                            </a>
                        </div>
<!--
                        <div class="next-nav">
                            <a href="frontpagenews-dashapplication.html" rel="next">
                                <span>Next</span>
                                Front Page News | Dash Application
                            </a>
                        </div>
-->
                    </div>

                </article>


            </div> <!-- end col-twelve -->
        </div> <!-- end row -->

    </section> <!-- end content -->


    <!-- footer
   ================================================== -->
    <footer>


        <div class="footer-bottom">
            <div class="row">

                <div class="col-twelve">
                    <div class="copyright">
                        <span>© Copyright 2019-2021</span>
                        <span>By <a href="index.html">Sumit Kant</a></span>
                    </div>

                    <div id="go-top">
                        <a class="smoothscroll" title="Back to Top" href="#top"><i class="icon icon-arrow-up"></i></a>
                    </div>
                </div>

            </div>
        </div> <!-- end footer-bottom -->

    </footer>

    <div id="preloader">
        <div id="loader"></div>
    </div>

    <!-- Java Script
   ================================================== -->
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/plugins.js"></script>
    <script src="../js/main.js"></script>

</body>

</html>

